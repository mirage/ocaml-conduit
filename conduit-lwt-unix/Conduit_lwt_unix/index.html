<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Conduit_lwt_unix (conduit-lwt-unix.Conduit_lwt_unix)</title><link rel="stylesheet" href="../../odoc.css"/><meta charset="utf-8"/><meta name="generator" content="odoc 2.0.0"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ <a href="../index.html">conduit-lwt-unix</a> &#x00BB; Conduit_lwt_unix</nav><header class="odoc-preamble"><h1>Module <code><span>Conduit_lwt_unix</span></code></h1></header><nav class="odoc-toc"><ul><li><a href="#core-types">Core types</a></li><li><a href="#connection-and-listening">Connection and listening</a></li><li><a href="#tls-library-selection">TLS library selection</a></li></ul></nav><div class="odoc-content"><p>Connection establishment using the <a href="http://ocsigen.org/lwt/api/Lwt_unix">Lwt_unix</a> library</p><h3 id="core-types"><a href="#core-types" class="anchor"></a>Core types</h3><div class="odoc-spec"><div class="spec type" id="type-client_tls_config" class="anchored"><a href="#type-client_tls_config" class="anchor"></a><code><span><span class="keyword">type</span> client_tls_config</span><span> = <span>[ <span>`Hostname of string</span> ]</span> * <span>[ <span>`IP of <span class="xref-unresolved">Ipaddr</span>.t</span> ]</span> * <span>[ <span>`Port of int</span> ]</span></span></code></div><div class="spec-doc"><p>Configuration fragment for a TLS client connecting to a remote endpoint</p></div></div><div class="odoc-spec"><div class="spec value" id="val-sexp_of_client_tls_config" class="anchored"><a href="#val-sexp_of_client_tls_config" class="anchor"></a><code><span><span class="keyword">val</span> sexp_of_client_tls_config : <span><a href="#type-client_tls_config">client_tls_config</a> <span class="arrow">&#45;&gt;</span></span> <span class="xref-unresolved">Ppx_sexp_conv_lib</span>.Sexp.t</span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-client_tls_config_of_sexp" class="anchored"><a href="#val-client_tls_config_of_sexp" class="anchor"></a><code><span><span class="keyword">val</span> client_tls_config_of_sexp : <span><span class="xref-unresolved">Ppx_sexp_conv_lib</span>.Sexp.t <span class="arrow">&#45;&gt;</span></span> <a href="#type-client_tls_config">client_tls_config</a></span></code></div></div><div class="odoc-spec"><div class="spec type" id="type-client" class="anchored"><a href="#type-client" class="anchor"></a><code><span><span class="keyword">type</span> client</span><span> = </span><span>[ </span></code><table><tr id="type-client.TLS" class="anchored"><td class="def constructor"><a href="#type-client.TLS" class="anchor"></a><code><span>| </span></code><code><span>`TLS <span class="keyword">of</span> <a href="#type-client_tls_config">client_tls_config</a></span></code></td></tr><tr id="type-client.TLS_native" class="anchored"><td class="def constructor"><a href="#type-client.TLS_native" class="anchor"></a><code><span>| </span></code><code><span>`TLS_native <span class="keyword">of</span> <a href="#type-client_tls_config">client_tls_config</a></span></code></td><td class="def-doc"><span class="comment-delim">(*</span><p>Force use of native OCaml TLS stack to connect.</p><span class="comment-delim">*)</span></td></tr><tr id="type-client.OpenSSL" class="anchored"><td class="def constructor"><a href="#type-client.OpenSSL" class="anchor"></a><code><span>| </span></code><code><span>`OpenSSL <span class="keyword">of</span> <a href="#type-client_tls_config">client_tls_config</a></span></code></td><td class="def-doc"><span class="comment-delim">(*</span><p>Force use of Lwt OpenSSL bindings to connect.</p><span class="comment-delim">*)</span></td></tr><tr id="type-client.TCP" class="anchored"><td class="def constructor"><a href="#type-client.TCP" class="anchor"></a><code><span>| </span></code><code><span>`TCP <span class="keyword">of</span> <span>[ <span>`IP of <span class="xref-unresolved">Ipaddr</span>.t</span> ]</span> * <span>[ <span>`Port of int</span> ]</span></span></code></td><td class="def-doc"><span class="comment-delim">(*</span><p>Use TCP to connect to the given <code>ip</code>, <code>port</code> tuple.</p><span class="comment-delim">*)</span></td></tr><tr id="type-client.Unix_domain_socket" class="anchored"><td class="def constructor"><a href="#type-client.Unix_domain_socket" class="anchor"></a><code><span>| </span></code><code><span>`Unix_domain_socket <span class="keyword">of</span> <span>[ <span>`File of string</span> ]</span></span></code></td><td class="def-doc"><span class="comment-delim">(*</span><p>Use UNIX domain sockets to connect to a socket on the <code>path</code>.</p><span class="comment-delim">*)</span></td></tr><tr id="type-client.Vchan_direct" class="anchored"><td class="def constructor"><a href="#type-client.Vchan_direct" class="anchor"></a><code><span>| </span></code><code><span>`Vchan_direct <span class="keyword">of</span> <span>[ <span>`Domid of int</span> ]</span> * <span>[ <span>`Port of string</span> ]</span></span></code></td><td class="def-doc"><span class="comment-delim">(*</span><p>Connect to the remote VM on the <code>domid</code>, <code>port</code> tuple.</p><span class="comment-delim">*)</span></td></tr><tr id="type-client.Vchan_domain_socket" class="anchored"><td class="def constructor"><a href="#type-client.Vchan_domain_socket" class="anchor"></a><code><span>| </span></code><code><span>`Vchan_domain_socket <span class="keyword">of</span> <span>[ <span>`Domain_name of string</span> ]</span> * <span>[ <span>`Port of string</span> ]</span></span></code></td><td class="def-doc"><span class="comment-delim">(*</span><p>Use the Vchan name resolution to connect</p><span class="comment-delim">*)</span></td></tr></table><code><span> ]</span></code></div><div class="spec-doc"><p>Set of supported client connections that are supported by this module:</p><ul><li><code>`TLS (`Hostname host, `IP ip, `Port port)</code>: Use OCaml-TLS or OpenSSL (depending on CONDUIT_TLS) to connect to the given <code>host</code>, <code>ip</code>, <code>port</code> tuple via TCP.</li><li><code>`TLS_native _</code>: Force use of native OCaml TLS stack to connect.</li><li><code>`OpenSSL _</code>: Force use of Lwt OpenSSL bindings to connect.</li><li><code>`TCP (`IP ip, `Port port)</code>: Use TCP to connect to the given <code>ip</code>, <code>port</code> tuple.</li><li><code>`Unix_domain_socket (`File path)</code>: Use UNIX domain sockets to connect to a socket on the <code>path</code>.</li><li><code>`Vchan_direct (`Domid domid, `Port port)</code>: Connect to the remote VM on the <code>domid</code>, <code>port</code> tuple.</li><li><code>`Vchan_domain_socket (`Domain_name domain, `Port port_name)</code>: Use the Vchan name resolution to connect.</li></ul></div></div><div class="odoc-spec"><div class="spec value" id="val-sexp_of_client" class="anchored"><a href="#val-sexp_of_client" class="anchor"></a><code><span><span class="keyword">val</span> sexp_of_client : <span><a href="#type-client">client</a> <span class="arrow">&#45;&gt;</span></span> <span class="xref-unresolved">Ppx_sexp_conv_lib</span>.Sexp.t</span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-client_of_sexp" class="anchored"><a href="#val-client_of_sexp" class="anchor"></a><code><span><span class="keyword">val</span> client_of_sexp : <span><span class="xref-unresolved">Ppx_sexp_conv_lib</span>.Sexp.t <span class="arrow">&#45;&gt;</span></span> <a href="#type-client">client</a></span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-__client_of_sexp__" class="anchored"><a href="#val-__client_of_sexp__" class="anchor"></a><code><span><span class="keyword">val</span> __client_of_sexp__ : <span><span class="xref-unresolved">Ppx_sexp_conv_lib</span>.Sexp.t <span class="arrow">&#45;&gt;</span></span> <a href="#type-client">client</a></span></code></div></div><div class="odoc-spec"><div class="spec type" id="type-server_tls_config" class="anchored"><a href="#type-server_tls_config" class="anchor"></a><code><span><span class="keyword">type</span> server_tls_config</span><span> = <span>[ <span>`Crt_file_path of string</span> ]</span> * <span>[ <span>`Key_file_path of string</span> ]</span> * <span>[ <span>`Password of <span>bool <span class="arrow">&#45;&gt;</span></span> string</span> <span>| `No_password</span> ]</span> * <span>[ <span>`Port of int</span> ]</span></span></code></div><div class="spec-doc"><p>Configuration fragment for a listening TLS server</p></div></div><div class="odoc-spec"><div class="spec value" id="val-sexp_of_server_tls_config" class="anchored"><a href="#val-sexp_of_server_tls_config" class="anchor"></a><code><span><span class="keyword">val</span> sexp_of_server_tls_config : <span><a href="#type-server_tls_config">server_tls_config</a> <span class="arrow">&#45;&gt;</span></span> <span class="xref-unresolved">Ppx_sexp_conv_lib</span>.Sexp.t</span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-server_tls_config_of_sexp" class="anchored"><a href="#val-server_tls_config_of_sexp" class="anchor"></a><code><span><span class="keyword">val</span> server_tls_config_of_sexp : <span><span class="xref-unresolved">Ppx_sexp_conv_lib</span>.Sexp.t <span class="arrow">&#45;&gt;</span></span> <a href="#type-server_tls_config">server_tls_config</a></span></code></div></div><div class="odoc-spec"><div class="spec type" id="type-tcp_config" class="anchored"><a href="#type-tcp_config" class="anchor"></a><code><span><span class="keyword">type</span> tcp_config</span><span> = </span><span>[ </span></code><table><tr id="type-tcp_config.Port" class="anchored"><td class="def constructor"><a href="#type-tcp_config.Port" class="anchor"></a><code><span>| </span></code><code><span>`Port <span class="keyword">of</span> int</span></code></td></tr><tr id="type-tcp_config.Socket" class="anchored"><td class="def constructor"><a href="#type-tcp_config.Socket" class="anchor"></a><code><span>| </span></code><code><span>`Socket <span class="keyword">of</span> <span class="xref-unresolved">Lwt_unix</span>.file_descr</span></code></td></tr></table><code><span> ]</span></code></div><div class="spec-doc"><p>Set of ways to create TCP servers</p><ul><li><code>`Port port</code>: Create a socket listening to provided port.</li><li><code>`Socket file_descr</code>: Use the provided file descriptor to create a server.</li></ul></div></div><div class="odoc-spec"><div class="spec value" id="val-sexp_of_tcp_config" class="anchored"><a href="#val-sexp_of_tcp_config" class="anchor"></a><code><span><span class="keyword">val</span> sexp_of_tcp_config : <span><a href="#type-tcp_config">tcp_config</a> <span class="arrow">&#45;&gt;</span></span> <span class="xref-unresolved">Ppx_sexp_conv_lib</span>.Sexp.t</span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-tcp_config_of_sexp" class="anchored"><a href="#val-tcp_config_of_sexp" class="anchor"></a><code><span><span class="keyword">val</span> tcp_config_of_sexp : <span><span class="xref-unresolved">Ppx_sexp_conv_lib</span>.Sexp.t <span class="arrow">&#45;&gt;</span></span> <a href="#type-tcp_config">tcp_config</a></span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-__tcp_config_of_sexp__" class="anchored"><a href="#val-__tcp_config_of_sexp__" class="anchor"></a><code><span><span class="keyword">val</span> __tcp_config_of_sexp__ : <span><span class="xref-unresolved">Ppx_sexp_conv_lib</span>.Sexp.t <span class="arrow">&#45;&gt;</span></span> <a href="#type-tcp_config">tcp_config</a></span></code></div></div><div class="odoc-spec"><div class="spec type" id="type-server" class="anchored"><a href="#type-server" class="anchor"></a><code><span><span class="keyword">type</span> server</span><span> = </span><span>[ </span></code><table><tr id="type-server.TLS" class="anchored"><td class="def constructor"><a href="#type-server.TLS" class="anchor"></a><code><span>| </span></code><code><span>`TLS <span class="keyword">of</span> <a href="#type-server_tls_config">server_tls_config</a></span></code></td></tr><tr id="type-server.OpenSSL" class="anchored"><td class="def constructor"><a href="#type-server.OpenSSL" class="anchor"></a><code><span>| </span></code><code><span>`OpenSSL <span class="keyword">of</span> <a href="#type-server_tls_config">server_tls_config</a></span></code></td></tr><tr id="type-server.TLS_native" class="anchored"><td class="def constructor"><a href="#type-server.TLS_native" class="anchor"></a><code><span>| </span></code><code><span>`TLS_native <span class="keyword">of</span> <a href="#type-server_tls_config">server_tls_config</a></span></code></td></tr><tr id="type-server.TCP" class="anchored"><td class="def constructor"><a href="#type-server.TCP" class="anchor"></a><code><span>| </span></code><code><span>`TCP <span class="keyword">of</span> <a href="#type-tcp_config">tcp_config</a></span></code></td></tr><tr id="type-server.Unix_domain_socket" class="anchored"><td class="def constructor"><a href="#type-server.Unix_domain_socket" class="anchor"></a><code><span>| </span></code><code><span>`Unix_domain_socket <span class="keyword">of</span> <span>[ <span>`File of string</span> ]</span></span></code></td></tr><tr id="type-server.Vchan_direct" class="anchored"><td class="def constructor"><a href="#type-server.Vchan_direct" class="anchor"></a><code><span>| </span></code><code><span>`Vchan_direct <span class="keyword">of</span> int * string</span></code></td></tr><tr id="type-server.Vchan_domain_socket" class="anchored"><td class="def constructor"><a href="#type-server.Vchan_domain_socket" class="anchor"></a><code><span>| </span></code><code><span>`Vchan_domain_socket <span class="keyword">of</span> string * string</span></code></td></tr><tr id="type-server.Launchd" class="anchored"><td class="def constructor"><a href="#type-server.Launchd" class="anchor"></a><code><span>| </span></code><code><span>`Launchd <span class="keyword">of</span> string</span></code></td></tr></table><code><span> ]</span></code></div><div class="spec-doc"><p>Set of supported listening mechanisms that are supported by this module.</p><ul><li><code>`TLS server_tls_config</code>: Use OCaml-TLS or OpenSSL (depending on CONDUIT_TLS) to connect to the given <code>host</code>, <code>ip</code>, <code>port</code> tuple via TCP.</li><li><code>`TLS_native _</code>: Force use of native OCaml TLS stack to connect.</li><li><code>`OpenSSL _</code>: Force use of Lwt OpenSSL bindings to connect.</li><li><code>`TCP (`Port port)</code>: Listen on the specified TCPv4 port.</li><li><code>`Unix_domain_socket (`File path)</code>: Use UNIX domain sockets to listen on the path.</li><li><code>`Vchan_direct (domid, port)</code>: Listen for the remote VM on the <code>domid</code>, <code>port</code> tuple.</li><li><code>`Vchan_domain_socket (domain, port_name)</code>: Use the Vchan name resolution to listen</li><li><code>`Listening_socket fd</code>: Use the socket given, useful for inherited systemd sockets.</li><li><code>`Launchd name</code>: uses MacOS X launchd to start the service, via the name of the <code>Sockets</code> element within the service description plist file. See the <a href="http://mirage.github.io/ocaml-launchd/launchd/">ocaml-launchd</a> documentation for more.</li></ul></div></div><div class="odoc-spec"><div class="spec value" id="val-sexp_of_server" class="anchored"><a href="#val-sexp_of_server" class="anchor"></a><code><span><span class="keyword">val</span> sexp_of_server : <span><a href="#type-server">server</a> <span class="arrow">&#45;&gt;</span></span> <span class="xref-unresolved">Ppx_sexp_conv_lib</span>.Sexp.t</span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-server_of_sexp" class="anchored"><a href="#val-server_of_sexp" class="anchor"></a><code><span><span class="keyword">val</span> server_of_sexp : <span><span class="xref-unresolved">Ppx_sexp_conv_lib</span>.Sexp.t <span class="arrow">&#45;&gt;</span></span> <a href="#type-server">server</a></span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-__server_of_sexp__" class="anchored"><a href="#val-__server_of_sexp__" class="anchor"></a><code><span><span class="keyword">val</span> __server_of_sexp__ : <span><span class="xref-unresolved">Ppx_sexp_conv_lib</span>.Sexp.t <span class="arrow">&#45;&gt;</span></span> <a href="#type-server">server</a></span></code></div></div><div class="odoc-spec"><div class="spec type" id="type-io" class="anchored"><a href="#type-io" class="anchor"></a><code><span><span class="keyword">type</span> <span>'a io</span></span><span> = <span><span class="type-var">'a</span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div></div><div class="odoc-spec"><div class="spec type" id="type-ic" class="anchored"><a href="#type-ic" class="anchor"></a><code><span><span class="keyword">type</span> ic</span><span> = <span class="xref-unresolved">Lwt_io</span>.input_channel</span></code></div></div><div class="odoc-spec"><div class="spec type" id="type-oc" class="anchored"><a href="#type-oc" class="anchor"></a><code><span><span class="keyword">type</span> oc</span><span> = <span class="xref-unresolved">Lwt_io</span>.output_channel</span></code></div></div><div class="odoc-spec"><div class="spec type" id="type-tcp_flow" class="anchored"><a href="#type-tcp_flow" class="anchor"></a><code><span><span class="keyword">type</span> tcp_flow</span><span> = <span class="keyword">private</span> </span><span>{</span></code><table><tr id="type-tcp_flow.fd" class="anchored"><td class="def record field"><a href="#type-tcp_flow.fd" class="anchor"></a><code><span>fd : <span class="xref-unresolved">Lwt_unix</span>.file_descr;</span></code></td></tr><tr id="type-tcp_flow.ip" class="anchored"><td class="def record field"><a href="#type-tcp_flow.ip" class="anchor"></a><code><span>ip : <span class="xref-unresolved">Ipaddr</span>.t;</span></code></td></tr><tr id="type-tcp_flow.port" class="anchored"><td class="def record field"><a href="#type-tcp_flow.port" class="anchor"></a><code><span>port : int;</span></code></td></tr></table><code><span>}</span></code></div><div class="spec-doc"><p><code>tcp_flow</code> contains the state of a single TCP connection.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-sexp_of_tcp_flow" class="anchored"><a href="#val-sexp_of_tcp_flow" class="anchor"></a><code><span><span class="keyword">val</span> sexp_of_tcp_flow : <span><a href="#type-tcp_flow">tcp_flow</a> <span class="arrow">&#45;&gt;</span></span> <span class="xref-unresolved">Ppx_sexp_conv_lib</span>.Sexp.t</span></code></div></div><div class="odoc-spec"><div class="spec type" id="type-domain_flow" class="anchored"><a href="#type-domain_flow" class="anchor"></a><code><span><span class="keyword">type</span> domain_flow</span><span> = <span class="keyword">private</span> </span><span>{</span></code><table><tr id="type-domain_flow.fd" class="anchored"><td class="def record field"><a href="#type-domain_flow.fd" class="anchor"></a><code><span>fd : <span class="xref-unresolved">Lwt_unix</span>.file_descr;</span></code></td></tr><tr id="type-domain_flow.path" class="anchored"><td class="def record field"><a href="#type-domain_flow.path" class="anchor"></a><code><span>path : string;</span></code></td></tr></table><code><span>}</span></code></div><div class="spec-doc"><p><code>domain_flow</code> contains the state of a single Unix domain socket connection.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-sexp_of_domain_flow" class="anchored"><a href="#val-sexp_of_domain_flow" class="anchor"></a><code><span><span class="keyword">val</span> sexp_of_domain_flow : <span><a href="#type-domain_flow">domain_flow</a> <span class="arrow">&#45;&gt;</span></span> <span class="xref-unresolved">Ppx_sexp_conv_lib</span>.Sexp.t</span></code></div></div><div class="odoc-spec"><div class="spec type" id="type-vchan_flow" class="anchored"><a href="#type-vchan_flow" class="anchor"></a><code><span><span class="keyword">type</span> vchan_flow</span><span> = <span class="keyword">private</span> </span><span>{</span></code><table><tr id="type-vchan_flow.domid" class="anchored"><td class="def record field"><a href="#type-vchan_flow.domid" class="anchor"></a><code><span>domid : int;</span></code></td></tr><tr id="type-vchan_flow.port" class="anchored"><td class="def record field"><a href="#type-vchan_flow.port" class="anchor"></a><code><span>port : string;</span></code></td></tr></table><code><span>}</span></code></div><div class="spec-doc"><p><code>vchan_flow</code> contains the state of a single Vchan shared memory connection.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-sexp_of_vchan_flow" class="anchored"><a href="#val-sexp_of_vchan_flow" class="anchor"></a><code><span><span class="keyword">val</span> sexp_of_vchan_flow : <span><a href="#type-vchan_flow">vchan_flow</a> <span class="arrow">&#45;&gt;</span></span> <span class="xref-unresolved">Ppx_sexp_conv_lib</span>.Sexp.t</span></code></div></div><div class="odoc-spec"><div class="spec type" id="type-flow" class="anchored"><a href="#type-flow" class="anchor"></a><code><span><span class="keyword">type</span> flow</span><span> = <span class="keyword">private</span> </span></code><table><tr id="type-flow.TCP" class="anchored"><td class="def variant constructor"><a href="#type-flow.TCP" class="anchor"></a><code><span>| </span><span><span class="constructor">TCP</span> <span class="keyword">of</span> <a href="#type-tcp_flow">tcp_flow</a></span></code></td></tr><tr id="type-flow.Domain_socket" class="anchored"><td class="def variant constructor"><a href="#type-flow.Domain_socket" class="anchor"></a><code><span>| </span><span><span class="constructor">Domain_socket</span> <span class="keyword">of</span> <a href="#type-domain_flow">domain_flow</a></span></code></td></tr><tr id="type-flow.Vchan" class="anchored"><td class="def variant constructor"><a href="#type-flow.Vchan" class="anchor"></a><code><span>| </span><span><span class="constructor">Vchan</span> <span class="keyword">of</span> <a href="#type-vchan_flow">vchan_flow</a></span></code></td></tr></table></div><div class="spec-doc"><p>A <code>flow</code> contains the state of a single connection, over a specific transport method.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-sexp_of_flow" class="anchored"><a href="#val-sexp_of_flow" class="anchor"></a><code><span><span class="keyword">val</span> sexp_of_flow : <span><a href="#type-flow">flow</a> <span class="arrow">&#45;&gt;</span></span> <span class="xref-unresolved">Ppx_sexp_conv_lib</span>.Sexp.t</span></code></div></div><div class="odoc-spec"><div class="spec type" id="type-tls_own_key" class="anchored"><a href="#type-tls_own_key" class="anchor"></a><code><span><span class="keyword">type</span> tls_own_key</span><span> = </span><span>[ </span></code><table><tr id="type-tls_own_key.None" class="anchored"><td class="def constructor"><a href="#type-tls_own_key.None" class="anchor"></a><code><span>| </span></code><code><span>`None</span></code></td></tr><tr id="type-tls_own_key.TLS" class="anchored"><td class="def constructor"><a href="#type-tls_own_key.TLS" class="anchor"></a><code><span>| </span></code><code><span>`TLS <span class="keyword">of</span> <span>[ <span>`Crt_file_path of string</span> ]</span> * <span>[ <span>`Key_file_path of string</span> ]</span> * <span>[ <span>`Password of <span>bool <span class="arrow">&#45;&gt;</span></span> string</span> <span>| `No_password</span> ]</span></span></code></td></tr></table><code><span> ]</span></code></div><div class="spec-doc"><p>Type describing where to locate a PEM key in the filesystem</p></div></div><div class="odoc-spec"><div class="spec value" id="val-sexp_of_tls_own_key" class="anchored"><a href="#val-sexp_of_tls_own_key" class="anchor"></a><code><span><span class="keyword">val</span> sexp_of_tls_own_key : <span><a href="#type-tls_own_key">tls_own_key</a> <span class="arrow">&#45;&gt;</span></span> <span class="xref-unresolved">Ppx_sexp_conv_lib</span>.Sexp.t</span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-tls_own_key_of_sexp" class="anchored"><a href="#val-tls_own_key_of_sexp" class="anchor"></a><code><span><span class="keyword">val</span> tls_own_key_of_sexp : <span><span class="xref-unresolved">Ppx_sexp_conv_lib</span>.Sexp.t <span class="arrow">&#45;&gt;</span></span> <a href="#type-tls_own_key">tls_own_key</a></span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-__tls_own_key_of_sexp__" class="anchored"><a href="#val-__tls_own_key_of_sexp__" class="anchor"></a><code><span><span class="keyword">val</span> __tls_own_key_of_sexp__ : <span><span class="xref-unresolved">Ppx_sexp_conv_lib</span>.Sexp.t <span class="arrow">&#45;&gt;</span></span> <a href="#type-tls_own_key">tls_own_key</a></span></code></div></div><div class="odoc-spec"><div class="spec type" id="type-ctx" class="anchored"><a href="#type-ctx" class="anchor"></a><code><span><span class="keyword">type</span> ctx</span></code></div><div class="spec-doc"><p>State handler for an active conduit</p></div></div><div class="odoc-spec"><div class="spec value" id="val-sexp_of_ctx" class="anchored"><a href="#val-sexp_of_ctx" class="anchor"></a><code><span><span class="keyword">val</span> sexp_of_ctx : <span><a href="#type-ctx">ctx</a> <span class="arrow">&#45;&gt;</span></span> <span class="xref-unresolved">Ppx_sexp_conv_lib</span>.Sexp.t</span></code></div></div><h3 id="connection-and-listening"><a href="#connection-and-listening" class="anchor"></a>Connection and listening</h3><div class="odoc-spec"><div class="spec value" id="val-default_ctx" class="anchored"><a href="#val-default_ctx" class="anchor"></a><code><span><span class="keyword">val</span> default_ctx : <span><a href="#type-ctx">ctx</a> <span class="xref-unresolved">Stdlib</span>.Lazy.t</span></span></code></div><div class="spec-doc"><p>Default context that listens on all source addresses with no TLS certificate associated with the Conduit</p></div></div><div class="odoc-spec"><div class="spec value" id="val-init" class="anchored"><a href="#val-init" class="anchor"></a><code><span><span class="keyword">val</span> init : <span>?src:string <span class="arrow">&#45;&gt;</span></span> <span>?tls_own_key:<a href="#type-tls_own_key">tls_own_key</a> <span class="arrow">&#45;&gt;</span></span> <span>?tls_authenticator:<a href="../Conduit_lwt_tls/X509/index.html#type-authenticator">Conduit_lwt_tls.X509.authenticator</a> <span class="arrow">&#45;&gt;</span></span> <span>unit <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-ctx">ctx</a> <a href="#type-io">io</a></span></span></code></div><div class="spec-doc"><p><code>init ?src ?tls_own_key ()</code> will initialize a Unix conduit that binds to the <code>src</code> interface if specified. If TLS server connections are used, then <code>tls_server_key</code> must contain a valid certificate to be used to advertise a TLS connection.</p><p>The certificate is validated using <code>tls_authenticator</code>. By default, the validation is using the <a href="https://github.com/mirage/ca-certs">OS trust anchors</a>.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-connect" class="anchored"><a href="#val-connect" class="anchor"></a><code><span><span class="keyword">val</span> connect : <span>ctx:<a href="#type-ctx">ctx</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-client">client</a> <span class="arrow">&#45;&gt;</span></span> <span><span>(<a href="#type-flow">flow</a> * <a href="#type-ic">ic</a> * <a href="#type-oc">oc</a>)</span> <a href="#type-io">io</a></span></span></code></div><div class="spec-doc"><p><code>connect ~ctx client</code> establishes an outgoing connection via the <code>ctx</code> context to the endpoint described by <code>client</code></p></div></div><div class="odoc-spec"><div class="spec value" id="val-serve" class="anchored"><a href="#val-serve" class="anchor"></a><code><span><span class="keyword">val</span> serve : <span>?backlog:int <span class="arrow">&#45;&gt;</span></span> <span>?timeout:int <span class="arrow">&#45;&gt;</span></span> <span>?stop:<span>unit <a href="#type-io">io</a></span> <span class="arrow">&#45;&gt;</span></span> <span>on_exn:<span>(<span>exn <span class="arrow">&#45;&gt;</span></span> unit)</span> <span class="arrow">&#45;&gt;</span></span> <span>ctx:<a href="#type-ctx">ctx</a>
<span class="arrow">&#45;&gt;</span></span> <span>mode:<a href="#type-server">server</a> <span class="arrow">&#45;&gt;</span></span> <span><span>(<span><a href="#type-flow">flow</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-ic">ic</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-oc">oc</a> <span class="arrow">&#45;&gt;</span></span> <span>unit <a href="#type-io">io</a></span>)</span> <span class="arrow">&#45;&gt;</span></span> <span>unit <a href="#type-io">io</a></span></span></code></div><div class="spec-doc"><p><code>serve ?backlog ?timeout ?stop ~on_exn ~ctx ~mode fn</code> establishes a listening connection of type <code>mode</code>, using the <code>ctx</code> context. The <code>stop</code> thread will terminate the server if it ever becomes determined. Every connection will be served in a new lightweight thread that is invoked via the <code>fn</code> callback. The <code>fn</code> callback is passed the <a href="#type-flow"><code>flow</code></a> representing the client connection and the associated input <a href="#type-ic"><code>ic</code></a> and output <a href="#type-oc"><code>oc</code></a> channels. If the callback raises an exception, it is passed to <code>on_exn</code>.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-set_max_active" class="anchored"><a href="#val-set_max_active" class="anchor"></a><code><span><span class="keyword">val</span> set_max_active : <span>int <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p><code>set_max_active nconn</code> sets the maximum number of active connections accepted. When the limit is hit accept blocks until another server connection is closed.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-endp_of_flow" class="anchored"><a href="#val-endp_of_flow" class="anchor"></a><code><span><span class="keyword">val</span> endp_of_flow : <span><a href="#type-flow">flow</a> <span class="arrow">&#45;&gt;</span></span> <a href="../../conduit/Conduit/index.html#type-endp">Conduit.endp</a></span></code></div><div class="spec-doc"><p><code>endp_of_flow flow</code> retrieves the original <a href="../../conduit/Conduit/index.html#type-endp"><code>Conduit.endp</code></a> from the established <code>flow</code></p></div></div><div class="odoc-spec"><div class="spec value" id="val-endp_to_client" class="anchored"><a href="#val-endp_to_client" class="anchor"></a><code><span><span class="keyword">val</span> endp_to_client : <span>ctx:<a href="#type-ctx">ctx</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="../../conduit/Conduit/index.html#type-endp">Conduit.endp</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-client">client</a> <a href="#type-io">io</a></span></span></code></div><div class="spec-doc"><p><code>endp_to_client ~ctx endp</code> converts an <code>endp</code> into a a concrete connection mechanism of type <code>client</code></p></div></div><div class="odoc-spec"><div class="spec value" id="val-endp_to_server" class="anchored"><a href="#val-endp_to_server" class="anchor"></a><code><span><span class="keyword">val</span> endp_to_server : <span>ctx:<a href="#type-ctx">ctx</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="../../conduit/Conduit/index.html#type-endp">Conduit.endp</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-server">server</a> <a href="#type-io">io</a></span></span></code></div><div class="spec-doc"><p><code>endp_to_server ~ctx endp</code> converts an <code>endp</code> into a a concrete connection mechanism of type <code>server</code></p></div></div><h3 id="tls-library-selection"><a href="#tls-library-selection" class="anchor"></a>TLS library selection</h3><div class="odoc-spec"><div class="spec type" id="type-tls_lib" class="anchored"><a href="#type-tls_lib" class="anchor"></a><code><span><span class="keyword">type</span> tls_lib</span><span> = </span></code><table><tr id="type-tls_lib.OpenSSL" class="anchored"><td class="def variant constructor"><a href="#type-tls_lib.OpenSSL" class="anchor"></a><code><span>| </span><span><span class="constructor">OpenSSL</span></span></code></td><td class="def-doc"><span class="comment-delim">(*</span><p>The <code>Lwt_ssl</code> bindings to the C OpenSSL library</p><span class="comment-delim">*)</span></td></tr><tr id="type-tls_lib.Native" class="anchored"><td class="def variant constructor"><a href="#type-tls_lib.Native" class="anchor"></a><code><span>| </span><span><span class="constructor">Native</span></span></code></td><td class="def-doc"><span class="comment-delim">(*</span><p>A pure OCaml TLS implementation</p><span class="comment-delim">*)</span></td></tr><tr id="type-tls_lib.No_tls" class="anchored"><td class="def variant constructor"><a href="#type-tls_lib.No_tls" class="anchor"></a><code><span>| </span><span><span class="constructor">No_tls</span></span></code></td><td class="def-doc"><span class="comment-delim">(*</span><p>No TLS implementation available, so any connections will fail</p><span class="comment-delim">*)</span></td></tr></table></div><div class="spec-doc"><p>Currently selected method of using TLS for client and servers</p></div></div><div class="odoc-spec"><div class="spec value" id="val-tls_library" class="anchored"><a href="#val-tls_library" class="anchor"></a><code><span><span class="keyword">val</span> tls_library : <span><a href="#type-tls_lib">tls_lib</a> <span class="xref-unresolved">Stdlib</span>.ref</span></span></code></div><div class="spec-doc"><p>The default selection is to select <a href="#type-tls_lib.OpenSSL"><code>OpenSSL</code></a>, <a href="#type-tls_lib.Native"><code>Native</code></a> and <a href="#type-tls_lib.No_tls"><code>No_tls</code></a> in decreasing order of priority. The native OCaml stack can be forced by setting the <code>CONDUIT_TLS</code> Unix environment variable to <code>native</code>.</p></div></div></div></body></html>